<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../styles/basic.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Dodo for me</title>
</head>
<body>
<div class="wrapper">
    <div class="header">
        <a href="../../index.html"><img class="header_gif" src="../../files/stars.gif" alt="Анимированные звездочки"></a>
    <nav>
        <a href="../../index.html">main</a>
        <a href="../skills.html">skills</a>
        <a href="../bio.html">biography</a>
        <a href="../experience.html">experience</a>
        <a href="../achievements.html">achievements</a>
        <a href="../contacts.html">contacts</a>
    </nav>
    <hr>
    </div>
    <div class="title">
        <h1>Я буду покупать всю пиццу</h1>
    </div>
    <div class="content">
        <p>Что потребовалось в моем кейсе:</p>
        <ul>
            <li>Burp Suite, burp proxy</li>
            <li>Android смартфон</li>
            <li>Приложение Додо</li>
        </ul>
        <h3>Разведка</h3>
        <p>В одно далекое время назад, "щупая" апи приложения Додо, заметил интересную особенность - всё меню приходит одной json-кой. В меню у каждой позициии есть свой id, название, описание, стоимость и прочие параметры. Ничего необычного (кроме длины в ~1.4кк символов).
        Но заинтересовала именно возможность переиспользовать id блюда в других местах.
        <p>Например, при заказе одной позиции, условно "самой дешевой", подменим ее id на позицию "подороже", идем в корзину и.. видим, что наш трюк не удался. Проверив еще несколько вариантов переиспользования id в одиночных позициях и в корзине, окончательно убеждаемся в том, что это не наш путь.</p>
        <p>Идем дальше и смотрим "комбо". Тут-то нам и улыбается удача.</p>
        <h3>Как работает комбо с точки зрения тела запроса</h3>
        <p>При выборе комбо, от клиента уходит запрос <b><i>/api/v2/cart</i></b>. В запросе есть важный параметр comboProducts. При добавлении в корзину комбо в этом параметре уходит id продуктов, которые были выбраны в состав комбо. Логика допускает гибкость для выбора разного состава одного и того же комбо (разные напитки, пиццы и т.п.)</p>
        <h3>Но как именно использовать параметр comboProducts в нашем баге с комбо?</h3>
        <p>Тут всё просто - нам поможет отстуствие валидации на стороне сервера О_О <br> Дальше все выглядит подозрительно просто:</p>
        <ol>
            <li>Заказываем комбо с кофе и пиццей. <a href="../../files/cases/dodo/phone_ordering.jpg" target="_blank">В интерфейсе</a> и в <a href="../../files/cases/dodo/burp_add_basket.png" target="_blank">запросе</a> отслеживаем контент.</li>
            <li><a href="../../files/cases/dodo/burp_intercept.png" target="_blank">Перехватываем запрос</a>, вставляем в comboProducts id блюд из меню</li>
            <li><a href="../../files/cases/dodo/burp_response.png" target="_blank">В ответе</a> от сервера видим, что наше дополнение в комбо "прижилось".</li>
            <li><a href="../../files/cases/dodo/phone_basket.jpg" target="_blank">Переходим в корзину</a>, видим что наше "расширенное" комбо отображается в полном обьеме при цене оригинального комбо.</li>
            <li>Делаем отложенный заказ, <a href="../../files/cases/dodo/phone_pay.jpg" target="_blank">оплачиваем его</a> и <s>ждем приготовления нашего комбо :)</s> отменяем заказ, т.к. мы не наживаемся на продуктовых багах (больше скринов экрана готовки <a href="../../files/cases/dodo/phone_staging_1.jpg" target="_blank">1</a>, <a href="../../files/cases/dodo/phone_staging_2.jpg" target="_blank">2</a>, <a href="../../files/cases/dodo/phone_staging_3.jpg" target="_blank">3</a>)</li>
        </ol>
        <h3>Что было дальше?</h3>
        <p>В выходной день ворвался в чат додо, узнал контакты нужного мне сотрудника, зарепортил, поймал нотку скептицизма и недоверия.<br>
        После воспроизведения бага сотрудниками додо, поймал лучи респекта и промокод на 15 пицц.. штош<br><br>
        Баг оперативно устранили, данную статью написал спустя очень много времени с момента обнаружения и устранения. </p>
    </div>
    <footer>
        <hr>
        <p>Email me: <a href="mailto: dporyadin@gmail.com">dporyadin@gmail.com</a></p>
    </footer>
</div>
</body>
</html>
